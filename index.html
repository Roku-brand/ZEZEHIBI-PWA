<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>是々日々</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="是々日々" />
    <meta name="theme-color" content="#F5F7F4" />
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-root">
      <main class="main-area">
        <section id="screenCalendar" class="screen screen-active">
          <div class="month-header">
            <button class="nav-btn" id="prevMonthBtn">&#x276E;</button>
            <div class="month-label" id="monthLabel">2025年11月</div>
            <button class="nav-btn" id="nextMonthBtn">&#x276F;</button>
          </div>

          <div class="weekday-row">
            <div class="wd sun">日</div>
            <div class="wd">月</div>
            <div class="wd">火</div>
            <div class="wd">水</div>
            <div class="wd">木</div>
            <div class="wd">金</div>
            <div class="wd sat">土</div>
          </div>

          <div class="calendar-wrapper">
            <div id="calendarGrid" class="calendar-grid"></div>
          </div>

          <div class="day-summary" id="daySummary">
            <span class="badge" id="selectedDateLabel">-</span>
            <span id="daySummaryText">まだ日記はありません。ダブルタップで作成できます。</span>
          </div>
        </section>

        <section id="screenEdit" class="screen">
          <div class="editor-header">
            <div class="editor-header-left">
              <div class="editor-date" id="editDateLabel">-</div>
              <button id="editDateTodayBtn" class="sub-btn">今日</button>
            </div>
            <div class="editor-header-right">
              <div id="saveStatus" class="save-status">未保存</div>
              <button type="button" id="deleteEntryBtn" class="danger-btn">削除</button>
              <button type="button" id="saveEntryBtn" class="primary-btn">保存</button>
            </div>
          </div>

          <form id="diaryForm" class="editor-form">
            <div class="grid-2">
              <label class="field-label">
                <span>起床時間</span>
                <input type="time" id="editWake" />
              </label>

              <label class="field-label">
                <span>体重 (kg)</span>
                <select id="editWeight" class="weight-picker"></select>
              </label>
            </div>

            <div class="meals-grid">
              <label class="field-label">
                <span>朝ごはん</span>
                <input
                  type="text"
                  id="editBreakfast" placeholder="例：トースト"
                />
              </label>

              <label class="field-label">
                <span>昼ごはん</span>
                <input
                  type="text"
                  id="editLunch" placeholder="例：定食"
                />
              </label>

              <label class="field-label">
                <span>夜ごはん</span>
                <input
                  type="text"
                  id="editDinner" placeholder="例：カレー"
                />
              </label>
            </div>

            <label class="field-label">
              <span>今日の注目ニュース / トピック</span>
              <textarea
                id="editNews" rows="2"
                placeholder="気になったニュース・出来事をメモ"
              ></textarea>
            </label>

            <label class="field-label">
              <span>タイトル</span>
              <input
                type="text"
                id="editTitle"
                placeholder="例：楽しい一日"
              />
            </label>

            <label class="field-label">
              <span>日記本文</span>
              <textarea
                id="editBody" rows="6"
                placeholder="一日の出来事や気づきを自由に書いてください"
              ></textarea>
            </label>

            <label class="field-label">
              <span>アイデア・トーク種</span>
              <textarea
                id="editIdea" rows="4"
                placeholder="思いついたアイデアや話したいことのメモ"
              ></textarea>
            </label>

            <label class="field-label">
              <span>充実度</span>
              <div class="satisfaction-picker" id="satisfactionPicker">
                <button type="button" class="satisfaction-btn" data-value="A">A</button>
                <button type="button" class="satisfaction-btn" data-value="B">B</button>
                <button type="button" class="satisfaction-btn" data-value="C">C</button>
              </div>
            </label>

            <div class="field-label">
              <span>写真</span>
              <div class="photo-upload-area">
                <input type="file" id="photoInput" accept="image/*" style="display: none" />
                <div id="photoPreview" class="photo-preview"></div>
                <div class="photo-buttons">
                  <button type="button" id="addPhotoBtn" class="sub-btn">📷 写真を追加</button>
                  <button type="button" id="removePhotoBtn" class="danger-btn" style="display: none">🗑 削除</button>
                </div>
              </div>
            </div>
          </form>
        </section>

        <section id="screenSearch" class="screen">
          <div class="section-header">
            <h2>検索</h2>
          </div>
          <div class="search-panel">
            <input
              type="text"
              id="searchInput"
              class="search-input"
              placeholder="キーワードで日記を検索"
            />
          </div>
          <div id="searchResults" class="search-grid"></div>
        </section>

        <section id="screenSettings" class="screen">
          <div class="section-header">
            <h2>管理</h2>
          </div>

          <div class="card-list scroll-section">
            <!-- アイデア・トーク種ライブラリ -->
            <div class="card idea-library-card">
              <div class="idea-library-header" id="ideaLibraryHeader">
                <div class="idea-library-header-content">
                  <div class="idea-library-icon">💡</div>
                  <div class="idea-library-header-text">
                    <div class="card-title">アイデア・トーク種ライブラリ</div>
                    <div class="card-sub">タップしてカテゴリを表示</div>
                  </div>
                </div>
                <div class="idea-library-toggle" id="ideaLibraryToggle">▼</div>
              </div>
              
              <div class="idea-library-body" id="ideaLibraryBody" style="display: none;">
                <!-- カテゴリ管理 -->
                <div class="idea-category-section">
                  <div class="idea-section-title">カテゴリ一覧</div>
                  <div id="ideaCategoryList" class="idea-category-list"></div>
                  <div class="idea-category-add">
                    <input type="text" id="newCategoryName" class="idea-category-input" placeholder="新しいカテゴリ名">
                    <button id="addCategoryBtn" class="idea-category-add-btn">＋</button>
                  </div>
                </div>
                
                <!-- アイデアリスト -->
                <div class="idea-list-section">
                  <div class="idea-section-title">アイデア一覧</div>
                  <div class="idea-library-controls">
                    <select id="ideaCategorySelect" class="idea-category-select"></select>
                    <button id="addIdeaBtn" class="primary-btn">＋追加</button>
                  </div>
                  <div id="ideaLibraryList" class="idea-library-list"></div>
                </div>
              </div>
            </div>

            <!-- アイデア追加モーダル（インライン） -->
            <div id="ideaAddForm" class="card" style="display: none;">
              <div class="card-title">新しいアイデアを追加</div>
              <div class="field-label">
                <span>カテゴリ</span>
                <select id="newIdeaCategory" class="idea-category-select"></select>
              </div>
              <div class="field-label">
                <span>内容</span>
                <textarea id="newIdeaContent" rows="3" placeholder="アイデアやトーク種を入力..."></textarea>
              </div>
              <div class="modal-actions">
                <button id="cancelIdeaBtn" class="sub-btn">キャンセル</button>
                <div class="flex-spacer"></div>
                <button id="saveIdeaBtn" class="primary-btn">保存</button>
              </div>
            </div>

            <div class="card">
              <div class="card-title">アカウント</div>
              <div class="card-sub" id="loginStatusLabel">
                未ログイン
              </div>
              <div class="modal-actions">
                <button id="googleLoginBtn" class="primary-btn">
                  Google でログイン
                </button>
                <button id="googleLogoutBtn" class="sub-btn" style="display: none;">
                  ログアウト
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-title">データのバックアップ</div>
              <div class="card-sub">
                ローカルのデータを JSON ファイルとしてエクスポート / インポートします。
              </div>
              <div class="modal-actions">
                <button id="exportBtn" class="primary-btn">エクスポート</button>
                <label class="sub-btn" for="importFile">インポート</label>
                <input
                  type="file"
                  id="importFile" accept="application/json"
                  style="display: none"
                />
              </div>
            </div>
          </div>
        </section>
      </main>

      <nav class="tab-bar">
        <button id="tabCalendar" class="tab-btn tab-active">カレンダー</button>
        <button id="tabEdit" class="tab-btn">閲覧・編集</button>
        <button id="tabSearch" class="tab-btn">検索</button>
        <button id="tabSettings" class="tab-btn">管理</button>
      </nav>
    </div>

    <script src="app.js"></script>
    <script>
      // Service Worker registration for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful');
            })
            .catch(function(err) {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
    </script>
  </body>
</html>
