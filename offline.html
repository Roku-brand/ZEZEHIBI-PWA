<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ â€” è¨˜éŒ²ã‚¢ãƒ—ãƒª</title>
  <meta name="theme-color" content="#5b8def" />
  <style>
    :root{
      --bg:#f6f7fb; --panel:#fff; --text:#1f2328; --muted:#6b7280; --accent:#5b8def; --line:#e5e7eb;
      --safe-top: env(safe-area-inset-top); --safe-right: env(safe-area-inset-right);
      --safe-bottom: env(safe-area-inset-bottom); --safe-left: env(safe-area-inset-left);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
    main{min-height:100dvh;display:grid;place-items:center;padding:24px}
    .card{max-width:min(720px,92vw);background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:8px 0;color:var(--muted);line-height:1.7}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{font:inherit;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
    .primary{background:var(--accent);border-color:var(--accent);color:#fff;font-weight:700}
    .muted{color:var(--muted)}
    .badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#334155;border:1px solid #c7d7ff}
    .hint{font-size:12px;color:var(--muted);margin-top:10px}
    .hero{font-size:42px;line-height:1;margin-bottom:8px}
    .list{margin:10px 0 0;padding-left:1.1em;color:#555}
    .list li{margin:.2em 0}
  </style>
</head>
<body>
  <main>
    <div class="card" role="alert">
      <div class="hero">ğŸ“´</div>
      <h1>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™</h1>
      <p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ¥ç¶šãŒå¾©å¸°ã™ã‚‹ã¨è‡ªå‹•ã§ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚Šã¾ã™ã€‚</p>
      <p class="muted">è¨˜éŒ²ã‚¢ãƒ—ãƒªã¯ PWA ã¨ã—ã¦<strong>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚èµ·å‹•</strong>ã§ãã¾ã™ãŒã€æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚„å¤–éƒ¨ãƒªãƒ³ã‚¯ã¯æ¥ç¶šãŒå¿…è¦ã§ã™ã€‚</p>

      <div class="row">
        <button id="retry" class="primary">å†èª­ã¿è¾¼ã¿</button>
        <button id="home">ãƒ›ãƒ¼ãƒ ã‚’é–‹ãï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰</button>
      </div>

      <p class="hint">
        çŠ¶æ…‹ï¼š<span class="badge" id="status">offline</span>
        <span id="lastSyncWrap" style="margin-left:8px;display:none">ï¼ æœ€çµ‚åŒæœŸ <span id="lastSync" class="badge"></span></span>
      </p>

      <ul class="list">
        <li>Wi-Fi / ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</li>
        <li>VPNã‚„æ©Ÿå†…ãƒ¢ãƒ¼ãƒ‰ãŒåŸå› ã®å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
        <li>å¾©å¸°å¾Œã¯è‡ªå‹•ã§ <code>index.html</code> ã¸æˆ»ã‚Šã¾ã™ã€‚</li>
      </ul>
    </div>
  </main>

  <script>
    // æœ€çµ‚åŒæœŸã®è¡¨ç¤ºï¼ˆä»»æ„ï¼‰ï¼šappå´ã§ä¿å­˜ã—ã¦ã„ã‚Œã°è¡¨ç¤º
    try{
      const t = localStorage.getItem('journal.lastSyncAt');
      if (t){
        const d = new Date(Number(t));
        document.getElementById('lastSync').textContent =
          `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
        document.getElementById('lastSyncWrap').style.display = 'inline';
      }
    }catch(_){}

    const statusEl = document.getElementById('status');
    const updateBadge = () => {
      const on = navigator.onLine;
      statusEl.textContent = on ? 'online' : 'offline';
      // å¾©å¸°ã—ãŸã‚‰è‡ªå‹•ã§ãƒ›ãƒ¼ãƒ ã¸
      if (on) location.replace('./index.html');
    };
    updateBadge();

    window.addEventListener('online', updateBadge);
    window.addEventListener('offline', updateBadge);

    document.getElementById('retry').addEventListener('click', () => {
      // ãƒãƒƒãƒˆå„ªå…ˆã§å†å–å¾—ã‚’è©¦ã¿ã‚‹
      location.reload();
    });
    document.getElementById('home').addEventListener('click', () => {
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿ index.html ã‚’é–‹ãï¼ˆSWãŒã‚ã‚Œã°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¿”ã‚‹ï¼‰
      location.href = './index.html';
    });

    // SWçµŒç”±ã§å³æ™‚æ›´æ–°ã—ãŸã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
    if (navigator.serviceWorker && navigator.serviceWorker.controller) {
      navigator.serviceWorker.controller.postMessage('SKIP_WAITING');
    }
  </script>
</body>
</html>
